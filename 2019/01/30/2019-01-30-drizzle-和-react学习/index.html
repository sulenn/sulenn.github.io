<!DOCTYPE html>
<html lang="chinese &amp; english">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->

    

    
        <meta name="description" content="GETTING STARTED WITH DRIZZLE AND REACT本文翻译至：https://truffleframework.com/tutorials/getting-started-with-drizzle-and-react 版本为：2018-08-28
Drizzle 是 Tru">
    

    <!--Author-->
    
        <meta name="author" content="qiubing">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="drizzle 和 react 学习">
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="GETTING STARTED WITH DRIZZLE AND REACT本文翻译至：https://truffleframework.com/tutorials/getting-started-with-drizzle-and-react 版本为：2018-08-28
Drizzle 是 Tru">
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="Sulenn">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="https://github.com/sulenn/sulenn.github.io/img/5.jpg">
    

        <meta name="twitter:card" content="summary_large_image">

    

    
        <meta name="twitter:image" content="https://github.com/sulenn/sulenn.github.io/img/5.jpg">
    

    <!-- Title -->
    
    <title>drizzle 和 react 学习 - Sulenn</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
    <link rel="icon" href="/img/favicon.ico">
    
  
</head>

<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">qiubing</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            
                                about
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/sulenn/sulenn.github.io">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('../../../../img/6.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>drizzle 和 react 学习</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by sulenn on
                        
                        
                            2019-01-30
                        
                        <!-- <span id="busuanzi_container_page_pv">with Reading <span id="busuanzi_value_page_pv"></span></span> -->
                    </span>
                    <span class="meta">
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/ethereum/">#ethereum</a> <a href="/tags/drizzle/">#drizzle</a> <a href="/tags/react/">#react</a> <a href="/tags/solidity/">#solidity</a> <a href="/tags/html/">#html</a> <a href="/tags/javascript/">#javascript</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/categories/blockchain/">blockchain</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <!-- 字数和阅读量 -->
                <span class="post-count" style="font-size: 16px">字数：5.7k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span id="busuanzi_container_page_pv" style="font-size: 16px">阅读量：<span id="busuanzi_value_page_pv"></span></span>


                <h1 id="GETTING-STARTED-WITH-DRIZZLE-AND-REACT"><a href="#GETTING-STARTED-WITH-DRIZZLE-AND-REACT" class="headerlink" title="GETTING STARTED WITH DRIZZLE AND REACT"></a>GETTING STARTED WITH DRIZZLE AND REACT</h1><p>本文翻译至：<a href="https://truffleframework.com/tutorials/getting-started-with-drizzle-and-react" target="_blank" rel="noopener">https://truffleframework.com/tutorials/getting-started-with-drizzle-and-react</a> 版本为：2018-08-28</p>
<p>Drizzle 是 Truffle Suite 的最新成员，也是我们的第一个前端开发工具。 Drizzle 的核心是将合约数据和交易数据等内容从区块链同步至 Redux store。 <code>drizzle</code> 基础库顶部有更高级别的抽象; 用于React兼容性 （<a href="https://truffleframework.com/docs/drizzle/react/react-integration" target="_blank" rel="noopener">drizzle-react</a>） 和一组即用型 React 组件 （<a href="https://truffleframework.com/docs/drizzle/react/react-components" target="_blank" rel="noopener">drizzle-react-components</a>） 的工具。</p>
<p>今天我们专注于初级应用，带你从头开始用 React 和 Drizzle 设置 Truffle 项目。通过这种方式，我们可以更好地了解 Drizzle 在应用中如何使用。有了这些知识，您可以利用您选择的任何前端框架充分利用 Drizzle，或者放心使用更高级别的React抽象</p>
<p>这将是一个非常初级的教程，专注于设置和获取存储在合约中的简单字符串。它适用于具有 Truffle 基础知识的人，此外还需要对 JavaScript 和 React.js 有一定的了解，但是不太熟悉 Drizzle 。</p>
<blockquote>
<p>注意：了解 Truffle 基础，可以参考 <a href="https://truffleframework.com/tutorials/pet-shop" target="_blank" rel="noopener">Pet Shop</a> 教程</p>
</blockquote>
<p>本教程将覆盖：</p>
<ol>
<li><p>设置开发环境</p>
</li>
<li><p>从头开始创建 Truffle 项目</p>
</li>
<li><p>编写智能合约</p>
</li>
<li><p>编译和移植智能合约</p>
</li>
<li><p>测试智能合约</p>
</li>
<li><p>创建 React.js 项目</p>
</li>
<li><p>设置前端客户端</p>
</li>
<li><p>用 Drizzle 连接 React 应用程序</p>
</li>
<li><p>写一个从 Drizzle 中读取的组件</p>
</li>
<li><p>写一个写入智能合约的组件</p>
</li>
</ol>
<h2 id="1-设置开发环境"><a href="#1-设置开发环境" class="headerlink" title="1. 设置开发环境"></a>1. 设置开发环境</h2><p>开始之前有一些技术要求。请安装以下内容：</p>
<ul>
<li><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js v8+ LTS and npm</a> (comes with Node)</li>
</ul>
<h3 id="1-1-Truffle"><a href="#1-1-Truffle" class="headerlink" title="1.1 Truffle"></a>1.1 Truffle</h3><p>安装如上内容后，安装 Truffle：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g truffle</span><br></pre></td></tr></table></figure>
<p>验证 Truffle 是否已正确安装，在终端上输入 <code>truffle version</code> 。如果发现错误，请检查是否已将npm模块添加到路径中。</p>
<h3 id="1-2-Ganache-CLI"><a href="#1-2-Ganache-CLI" class="headerlink" title="1.2 Ganache-CLI"></a>1.2 Ganache-CLI</h3><p>我们还将使用 Ganache-CLI ，这是一个用于以太坊开发的个人区块链，可用于部署合约、开发应用程序和运行测试。 可以使用以下命令全局安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g ganache-cli</span><br></pre></td></tr></table></figure>
<p>这里如果出现非全局安装问题，可使用 <code>ln -s</code> 将 ganache-cli 链接至 <code>/usr/local/bin/</code> 。详细使用方法请 google</p>
<h3 id="1-3-Create-React-App"><a href="#1-3-Create-React-App" class="headerlink" title="1.3 Create-React-App"></a>1.3 Create-React-App</h3><p>最后，由于这是一个 React.js 教程，我们将使用 <a href="https://github.com/facebook/create-react-app/">Create-React-App</a> 创建我们的React项目</p>
<p>如果你拥有 NPM 5.2 或更高版本，则无需执行任何操作。你可以通过运行 <code>npm --version</code> 来检查 <code>NPM</code> 版本。如果没有，则需要使用以下命令全局安装该工具：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g create-react-app</span><br></pre></td></tr></table></figure>
<h2 id="2-创建-Truffle-项目"><a href="#2-创建-Truffle-项目" class="headerlink" title="2. 创建 Truffle 项目"></a>2. 创建 Truffle 项目</h2><ol>
<li><p>Truffle 在当前目录中初始化，因此首先在你选择的开发文件夹中创建一个目录，然后移动至目录</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir drizzle-react-tutorial</span><br><span class="line">cd drizzle-react-tutorial</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行如下命令生成空 Truffle 项目</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle init</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>简单看一下生成的目录结构</p>
<h3 id="2-1-目录结构"><a href="#2-1-目录结构" class="headerlink" title="2.1 目录结构"></a>2.1 目录结构</h3><p>默认的目录结构包含如下：</p>
<ul>
<li><p><code>contracts/</code> : 包含我们智能合约的 <a href="https://solidity.readthedocs.io/" target="_blank" rel="noopener">Solidity</a> 源文件。 这里有一个名为 <code>Migrations.sol</code> 的重要合约，我们稍后会讨论。</p>
</li>
<li><p><code>migrations/</code> ：<code>Truffle</code> 使用移植系统来处理智能合约部署。 移植是一种特殊的智能合约，可以跟踪合约变化。</p>
</li>
<li><p><code>test/</code> ：包含智能合约 JavaScript 和 Solidity 测试</p>
</li>
<li><p><code>truffle-config.js</code> ：Truffle 配置文件</p>
</li>
</ul>
<h2 id="3-编写智能合约"><a href="#3-编写智能合约" class="headerlink" title="3. 编写智能合约"></a>3. 编写智能合约</h2><p>我们将添加一个名为 MyStringStore 的简单智能合约。</p>
<ol>
<li><p>在 <code>contracts/</code> 目录中创建名为 <code>MyStringStore.sol</code> 的新文件。</p>
</li>
<li><p>文件中添加如下内容：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract MyStringStore &#123;</span><br><span class="line">string public myString = &quot;Hello World&quot;;</span><br><span class="line"></span><br><span class="line">function set(string memory x) public &#123;</span><br><span class="line">    myString = x;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>由于这不是Solidity教程，所以您需要了解的是：</p>
<ul>
<li><p>我们创建了一个名为 <code>myString</code> 的公共字符串变量，并将其初始化为 “Hello World” 。 这会自动创建一个 getter方法（因为它是一个公共变量），所以我们不必自己编写一个。</p>
</li>
<li><p>我们创建了一个 setter 方法，将 <code>myString</code> 变量设置为传入的任何字符串。</p>
</li>
</ul>
<p><strong>注意：</strong></p>
<p>这里需要在 set 函数传入参数 x 中添加 memory 属性，不然可能会在 4.1 编译部分出现如下错误（应该是 solidity 版本的问题）：</p>
<p><img src="http://ww1.sinaimg.cn/large/006alGmrgy1fzojk8nckuj30k405maaq.jpg" alt="3"></p>
<h3 id="3-1-运行测试链"><a href="#3-1-运行测试链" class="headerlink" title="3.1 运行测试链"></a>3.1 运行测试链</h3><p>在我们继续操作之前，让我们首先使用 Ganache-CLI 启动我们的测试区块链。</p>
<p>打开一个新终端并运行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ganache-cli -b 3</span><br></pre></td></tr></table></figure>
<p>这将生成一个新的区块链，默认情况下会侦听127.0.0.1:8545，并将每3秒进行一次挖矿。 如果我们没有指定这个，Ganache会立即挖矿，我们将无法模拟真正的区块链开采所需的延迟。</p>
<p>保持终端窗口打开，您可以观察稍后与之交互时发生的情况</p>
<h3 id="3-2-指定网络"><a href="#3-2-指定网络" class="headerlink" title="3.2 指定网络"></a>3.2 指定网络</h3><p>我们需要让我们的 Truffle 项目知道如何连接到这个区块链。 要做到这一点，我们需要将以下内容放在 <code>truffle-config.js中</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  networks: &#123;</span><br><span class="line">    development: &#123;</span><br><span class="line">      host: <span class="string">"localhost"</span>,</span><br><span class="line">      port: <span class="number">8545</span>,</span><br><span class="line">      network_id: <span class="string">"*"</span> <span class="comment">// Match any network id</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="4-编译和移植智能合约"><a href="#4-编译和移植智能合约" class="headerlink" title="4. 编译和移植智能合约"></a>4. 编译和移植智能合约</h2><p>现在我们准备编译和移植合约</p>
<h3 id="4-1-编译"><a href="#4-1-编译" class="headerlink" title="4.1 编译"></a>4.1 编译</h3><ol>
<li><p>在终端中，确保您位于项目目录的根目录中并输入：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle compile</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>如果您使用的是 Windows 并且在运行此命令时遇到问题，请参阅文档 <a href="https://truffleframework.com/docs/advanced/configuration#resolving-naming-conflicts-on-windows" target="_blank" rel="noopener">resolving naming conflicts on Windows</a></p>
</blockquote>
<p>您应该看到类似于以下输出内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Compiling ./contracts/Migrations.sol...</span><br><span class="line">Compiling ./contracts/MyStringStore.sol...</span><br><span class="line">Writing artifacts to ./build/contracts</span><br></pre></td></tr></table></figure>
<h3 id="4-2-移植"><a href="#4-2-移植" class="headerlink" title="4.2 移植"></a>4.2 移植</h3><p>现在我们已经成功编译了合约，是时候将它们移植到区块链了！</p>
<blockquote>
<p>注意：阅读更多关于移植 <a href="https://truffleframework.com/docs/getting_started/migrations" target="_blank" rel="noopener">Truffle documentation</a></p>
</blockquote>
<p>创建移植脚本</p>
<ol>
<li><p>在 <code>migrations/</code> 目录中创建名为 <code>2_deploy_contracts.js</code> 的新文件</p>
</li>
<li><p>文件中添加如下内容：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyStringStore = artifacts.require(<span class="string">"MyStringStore"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">deployer</span>) </span>&#123;</span><br><span class="line">deployer.deploy(MyStringStore);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回终端，移植合约到区块链</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle migrate</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>你可以看到如下类似输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Using network 'development'.</span><br><span class="line"></span><br><span class="line">Running migration: 1_initial_migration.js</span><br><span class="line">  Deploying Migrations...</span><br><span class="line">  ... 0xcc1a5aea7c0a8257ba3ae366b83af2d257d73a5772e84393b0576065bf24aedf</span><br><span class="line">  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956</span><br><span class="line">Saving artifacts...</span><br><span class="line">Running migration: 2_deploy_contracts.js</span><br><span class="line">  Deploying MyStringStore...</span><br><span class="line">  ... 0x43b6a6888c90c38568d4f9ea494b9e2a22f55e506a8197938fb1bb6e5eaa5d34</span><br><span class="line">  MyStringStore: 0x345ca3e014aaf5dca488057592ee47305d9b3e10</span><br><span class="line">Saving successful migration to network...</span><br><span class="line">  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0</span><br><span class="line">Saving artifacts...</span><br></pre></td></tr></table></figure>
<p>您可以按顺序查看正在执行的移植，然后是每个已部署合同的区块链地址（您的地址将有所不同）。</p>
<h2 id="5-测试智能合约"><a href="#5-测试智能合约" class="headerlink" title="5. 测试智能合约"></a>5. 测试智能合约</h2><p>在我们继续之前，我们应该编写几个测试来确保合约按预期工作。</p>
<ol>
<li><p>在 <code>test/</code> 目录中创建一个名为 <code>MyStringStore.js</code> 的新文件。</p>
</li>
<li><p>将以下内容添加到 <code>MyStringStore.js</code> 文件：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyStringStore = artifacts.require(<span class="string">"./MyStringStore.sol"</span>);</span><br><span class="line"></span><br><span class="line">contract(<span class="string">"MyStringStore"</span>, accounts =&gt; &#123;</span><br><span class="line">it(<span class="string">"should store the string 'Hey there!'"</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> myStringStore = <span class="keyword">await</span> MyStringStore.deployed();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set myString to "Hey there!"</span></span><br><span class="line">    <span class="keyword">await</span> myStringStore.set(<span class="string">"Hey there!"</span>, &#123; <span class="attr">from</span>: accounts[<span class="number">0</span>] &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get myString from public variable getter</span></span><br><span class="line">    <span class="keyword">const</span> storedString = <span class="keyword">await</span> myStringStore.myString.call();</span><br><span class="line"></span><br><span class="line">    assert.equal(storedString, <span class="string">"Hey there!"</span>, <span class="string">"The string was not stored"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-1-运行测试"><a href="#5-1-运行测试" class="headerlink" title="5.1 运行测试"></a>5.1 运行测试</h3><ol>
<li><p>返回终端，运行测试：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle test</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果所有测试都通过，您将在控制台看到与此类似的输出：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Using network 'development'.</span><br><span class="line"></span><br><span class="line">Contract: MyStringStore</span><br><span class="line">    ✓ should store the value 'Hey there!' (3085ms)</span><br><span class="line"></span><br><span class="line">1 passing (3s)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>真棒！ 现在我们知道合同确实有效。</p>
<h2 id="6-创建-React-js-项目"><a href="#6-创建-React-js-项目" class="headerlink" title="6. 创建 React.js 项目"></a>6. 创建 React.js 项目</h2><p>现在我们完成了智能合约，我们可以用 React.js 编写我们的前端客户端！ 为此，只需运行此命令（如果您有NPM 5.2或更高版本）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app client</span><br></pre></td></tr></table></figure>
<p>如果您有较旧版本的 NPM ，请确保按照 <a href="https://truffleframework.com/tutorials/getting-started-with-drizzle-and-react#create-react-app" target="_blank" rel="noopener">Setting up the development environment</a> 部分中的说明全局安装 Create-React-App ，然后运行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-react-app client</span><br></pre></td></tr></table></figure>
<p>这应该在您的 Truffle 项目中创建一个 <code>client</code> 目录，并生成一个裸的  React.js 项目，让你开始构建您的前端。</p>
<h2 id="7-设置前端客户端"><a href="#7-设置前端客户端" class="headerlink" title="7. 设置前端客户端"></a>7. 设置前端客户端</h2><p>现在我们在 <code>client</code> 目录中有一个前端客户端，使用命令 <code>cd client</code> 切换到该目录，然后继续执行以下步骤进行设置。</p>
<h3 id="7-1-链接编译文件"><a href="#7-1-链接编译文件" class="headerlink" title="7.1 链接编译文件"></a>7.1 链接编译文件</h3><p>由于 Create-React-App 默认不允许从 <code>src</code> 文件夹外部导入文件，因此我们需要将我们 <code>build</code> 文件夹中的 contracts 放入 <code>src</code> 中。 我们可以在每次编译合约时复制和粘贴一次，但更好的方法是创建符号链接。</p>
<p>如果你之前没有创建过符号链接，请将其视为文件系统中的一个 magical portal </p>
<p>切换到 <code>src</code> 目录，然后创建符号链接文件夹：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// For MacOS and Linux</span><br><span class="line"></span><br><span class="line">cd src</span><br><span class="line">ln -s ../../build/contracts contracts</span><br><span class="line"></span><br><span class="line">// For Windows 7, 8 and 10</span><br><span class="line">// Using a Command Prompt as Admin</span><br><span class="line"></span><br><span class="line">cd src</span><br><span class="line">mklink /D contracts ..\..\build\contracts</span><br></pre></td></tr></table></figure>
<p>实际上，这应该在 <code>src</code> 中创建看起来像 <code>contract</code> 文件夹的内容，但它实际上指向我们的 Truffle 项目的 <code>build/contracts</code> 文件夹中的文件。</p>
<h3 id="7-2-安装-Drizzle"><a href="#7-2-安装-Drizzle" class="headerlink" title="7.2 安装 Drizzle"></a>7.2 安装 Drizzle</h3><p>这是最有趣的部分，我们安装 Drizzle。 使用命令 <code>cd ..</code> 更改回 <code>client</code> 目录，然后运行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install drizzle</span><br></pre></td></tr></table></figure>
<p>这就是依赖关系！ 请注意，我们不需要自己安装 Web3.js 或 Truffle-Contract 。 Drizzle 包含我们与智能合约交互所需的一切。</p>
<h2 id="8-用-Drizzle-连接-React-应用程序"><a href="#8-用-Drizzle-连接-React-应用程序" class="headerlink" title="8. 用 Drizzle 连接 React 应用程序"></a>8. 用 Drizzle 连接 React 应用程序</h2><p>在我们进一步讨论之前，让我们通过在 <code>client</code> 目录中运行如下命令来启动我们的 React 应用程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>这将在 <code>localhost：3000</code> 下启动前端服务，因此请在浏览器中打开它</p>
<blockquote>
<p>注意：如果已经安装了 MetaMask，请确保使用隐身窗口（或暂时禁用 MetaMask ）。 否则，应用程序将尝试使用 MetaMask 中指定的网络，而不是 localhost：8545 下的开发网络。</p>
</blockquote>
<p>如果加载的默认 Create-React-App 页面没有任何问题，你可以继续。</p>
<h3 id="8-1-设置商店"><a href="#8-1-设置商店" class="headerlink" title="8.1 设置商店"></a>8.1 设置商店</h3><p>我们需要做的第一件事是设置和实例化Drizzle商店。我们把以下5行添加到 <code>client/src/index.js</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import drizzle functions and contract artifact</span></span><br><span class="line"><span class="keyword">import</span> &#123; Drizzle, generateStore &#125; <span class="keyword">from</span> <span class="string">"drizzle"</span>;</span><br><span class="line"><span class="keyword">import</span> MyStringStore <span class="keyword">from</span> <span class="string">"./contracts/MyStringStore.json"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// let drizzle know what contracts we want</span></span><br><span class="line"><span class="keyword">const</span> options = &#123; <span class="attr">contracts</span>: [MyStringStore] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup the drizzle store and drizzle</span></span><br><span class="line"><span class="keyword">const</span> drizzleStore = generateStore(options);</span><br><span class="line"><span class="keyword">const</span> drizzle = <span class="keyword">new</span> Drizzle(options, drizzleStore);</span><br></pre></td></tr></table></figure>
<p>首先，我们从 Drizzle 和软连接的合约定义中导入工具</p>
<p>然后我们为 Drizzle 构建了我们的选项对象，在这种情况下，它只是通过传入 JSON 构建工件来指定我们想要加载的特定合约。</p>
<p>最后，我们创建了 <code>drizzleStore</code> 并使用它来创建我们的 <code>drizzle</code> 实例，我们将其作为支持传递给我们的 <code>App</code> 组件。</p>
<p>完成后，<code>index.js</code> 应如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./index.css"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App"</span>;</span><br><span class="line"><span class="keyword">import</span> registerServiceWorker <span class="keyword">from</span> <span class="string">"./registerServiceWorker"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// import drizzle functions and contract artifact</span></span><br><span class="line"><span class="keyword">import</span> &#123; Drizzle, generateStore &#125; <span class="keyword">from</span> <span class="string">"drizzle"</span>;</span><br><span class="line"><span class="keyword">import</span> MyStringStore <span class="keyword">from</span> <span class="string">"./contracts/MyStringStore.json"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// let drizzle know what contracts we want</span></span><br><span class="line"><span class="keyword">const</span> options = &#123; <span class="attr">contracts</span>: [MyStringStore] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup the drizzle store and drizzle</span></span><br><span class="line"><span class="keyword">const</span> drizzleStore = generateStore(options);</span><br><span class="line"><span class="keyword">const</span> drizzle = <span class="keyword">new</span> Drizzle(options, drizzleStore);</span><br><span class="line"></span><br><span class="line"><span class="comment">// pass in the drizzle instance</span></span><br><span class="line">ReactDOM.render(&lt;App drizzle=&#123;drizzle&#125; /&gt;, document.getElementById("root"));</span><br><span class="line">registerServiceWorker();</span><br></pre></td></tr></table></figure>
<p>再次注意， <code>drizzle</code> 实例作为 <code>props</code> 传递到 <code>App</code> 组件。</p>
<h3 id="8-2-连接-App-组件"><a href="#8-2-连接-App-组件" class="headerlink" title="8.2 连接 App 组件"></a>8.2 连接 App 组件</h3><p>现在我们有一个 <code>drizzle</code> 实例，我们可以进入 <code>client/src/App.js</code> 开始使用 React API。</p>
<h4 id="8-2-1-添加状态变量"><a href="#8-2-1-添加状态变量" class="headerlink" title="8.2.1 添加状态变量"></a>8.2.1 添加状态变量</h4><p>我们要做的第一件事是在我们的 App 组件中添加以下行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state = &#123; <span class="attr">loading</span>: <span class="literal">true</span>, <span class="attr">drizzleState</span>: <span class="literal">null</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>我们将在这里使用两个状态变量：</p>
<ol>
<li><p><code>loading</code> — 指示 Drizzle 是否已完成初始化并且应用程序已准备就绪。 初始化过程包括实例化 <code>web3</code> 和我们的智能合约，获取任何可用的以太坊帐户并监听（或者，在不支持订阅的情况下：轮询）新块。</p>
</li>
<li><p><code>drizzleState</code> — 这是我们将 Drizzle 商店的状态存储在顶级组件中的位置。 如果我们可以保持这个状态变量是最新的，那么我们可以简单地使用简单的 <code>props</code> 和 <code>state</code> 来使用 Drizzle（即你不必使用任何 Redux 或高级 React 模式）。</p>
</li>
</ol>
<h4 id="8-2-2-添加一些初始化逻辑"><a href="#8-2-2-添加一些初始化逻辑" class="headerlink" title="8.2.2 添加一些初始化逻辑"></a>8.2.2 添加一些初始化逻辑</h4><p>接下来，我们将 <code>componentDidMount</code> 方法添加到组件类中，以便我们可以运行一些初始化逻辑。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; drizzle &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// subscribe to changes in the store</span></span><br><span class="line">  <span class="keyword">this</span>.unsubscribe = drizzle.store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// every time the store updates, grab the state from drizzle</span></span><br><span class="line">    <span class="keyword">const</span> drizzleState = drizzle.store.getState();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check to see if it's ready, if so, update local component state</span></span><br><span class="line">    <span class="keyword">if</span> (drizzleState.drizzleStatus.initialized) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">loading</span>: <span class="literal">false</span>, drizzleState &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先，我们从 props 中获取 <code>drizzle</code> 实例，然后我们调用<code>drizzle.store.subscribe</code> 并传入一个回调函数。 每当更新 Drizzle 存储时，都会调用此回调函数。 请注意，这个商店实际上是一个 Redux 商店，所以如果您之前使用过 Redux，这可能看起来很熟悉。</p>
<p>每当更新商店时，我们将尝试使用 <code>drizzle.store.getState（）</code> 获取状态，然后如果初始化并准备好 Drizzle，我们将 <code>loading</code> 设置为false，并更新 <code>drizzleState</code> 状态变量。</p>
<p>通过这样做，<code>drizzleState</code> 将始终是最新的，我们也确切知道 Drizzle 何时准备就绪，因此我们可以使用加载组件让用户知道。</p>
<h4 id="8-2-3-取消订阅商店"><a href="#8-2-3-取消订阅商店" class="headerlink" title="8.2.3 取消订阅商店"></a>8.2.3 取消订阅商店</h4><p>请注意，我们将 <code>subscribe（）</code> 的返回值赋给类变量 <code>this.unsubscribe</code> 。 这是因为取消订阅组件卸载时的任何订阅始终是一种好习惯。 为了做到这一点，我们保存对该订阅的引用（即 <code>this.unsubscribe</code> ），并在 <code>componentWillUnmount</code> 中，我们有以下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentWillUnmount() &#123;</span><br><span class="line">  <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当 App 组件卸载时，这将安全取消订阅，因此我们可以防止任何内存泄漏。</p>
<h4 id="8-2-4-替换-render-方法"><a href="#8-2-4-替换-render-方法" class="headerlink" title="8.2.4 替换 render 方法"></a>8.2.4 替换 <code>render</code> 方法</h4><p>最后，我们可以用更适合我们的东西替换 boilerplate render 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state.loading) <span class="keyword">return</span> <span class="string">"Loading Drizzle..."</span>;</span><br><span class="line">  <span class="keyword">return</span> &lt;div className="App"&gt;Drizzle is ready&lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在下一节中，我们将使用从商店中读取的实际组件替换 “Drizzle ready”。 如果您现在刷新浏览器并运行此应用程序，您应该会在屏幕上看到 “Loading Drizzle…”，然后 “Drizzle is ready”。</p>
<h3 id="8-3-完整的组件代码"><a href="#8-3-完整的组件代码" class="headerlink" title="8.3 完整的组件代码"></a>8.3 完整的组件代码</h3><p>完成此部分后，您的 App 组件应如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">loading</span>: <span class="literal">true</span>, <span class="attr">drizzleState</span>: <span class="literal">null</span> &#125;;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; drizzle &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// subscribe to changes in the store</span></span><br><span class="line">    <span class="keyword">this</span>.unsubscribe = drizzle.store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// every time the store updates, grab the state from drizzle</span></span><br><span class="line">      <span class="keyword">const</span> drizzleState = drizzle.store.getState();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// check to see if it's ready, if so, update local component state</span></span><br><span class="line">      <span class="keyword">if</span> (drizzleState.drizzleStatus.initialized) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; <span class="attr">loading</span>: <span class="literal">false</span>, drizzleState &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.loading) <span class="keyword">return</span> <span class="string">"Loading Drizzle..."</span>;</span><br><span class="line">    <span class="keyword">return</span> &lt;div className="App"&gt;Drizzle is ready&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-写一个从-Drizzle-中读取的组件"><a href="#9-写一个从-Drizzle-中读取的组件" class="headerlink" title="9. 写一个从 Drizzle 中读取的组件"></a>9. 写一个从 Drizzle 中读取的组件</h2><p>首先，让我们在 <code>client/src/ReadString.js</code> 创建一个新文件并粘贴如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadString</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; drizzle, drizzleState &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="built_in">console</span>.log(drizzle);</span><br><span class="line">    <span class="built_in">console</span>.log(drizzleState);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;ReadString Component&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ReadString;</span><br></pre></td></tr></table></figure>
<p>然后在 <code>App.js</code> 中，使用以下语句导入新组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ReadString <span class="keyword">from</span> <span class="string">"./ReadString"</span>;</span><br></pre></td></tr></table></figure>
<p>现在修改你的 <code>App.js</code> 的 render 方法，以便我们从 props 中传递 <code>drizzle</code> 实例以及从组件状态传递 <code>drizzleState</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state.loading) <span class="keyword">return</span> <span class="string">"Loading Drizzle..."</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;ReadString</span><br><span class="line">        drizzle=&#123;<span class="keyword">this</span>.props.drizzle&#125;</span><br><span class="line">        drizzleState=&#123;<span class="keyword">this</span>.state.drizzleState&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>返回浏览器并打开控制台。 您应该看到两个 <code>console.log</code> 语句正在运行，它们同时显示 <code>drizzle</code> 实例以及完全初始化的 <code>drizzleState</code>。</p>
<p>这告诉我们的是，一旦这个组件安装完毕，我们在这个组件中得到的 <code>drizzleState</code> 将始终完全就绪。 此时，您可以花一些时间来探索 <code>drizzle</code> 实例对象以及 <code>drizzleState</code> 对象。</p>
<h3 id="9-1-drizzle-实例和-drizzleState"><a href="#9-1-drizzle-实例和-drizzleState" class="headerlink" title="9.1 drizzle 实例和 drizzleState"></a>9.1 <code>drizzle</code> 实例和 <code>drizzleState</code></h3><p>在大多数情况下，<code>drizzleState</code> 是您从中读取信息（即合同状态变量，返回值，交易状态，帐户数据等），而 <code>drizzle</code> 实例是您将用来实际完成任务（即调用） 合同方法， Web3 实例等）。</p>
<h3 id="9-2-连接-ReadString-组件"><a href="#9-2-连接-ReadString-组件" class="headerlink" title="9.2 连接 ReadString 组件"></a>9.2 连接 <code>ReadString</code> 组件</h3><p>现在我们可以访问我们的 <code>drizzle</code> 实例和 <code>drizzleState</code> ，我们可以输入允许我们读取我们感兴趣的智能合约变量的逻辑。以下是 <code>ReadString.js</code> 的完整代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadString</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">dataKey</span>: <span class="literal">null</span> &#125;;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; drizzle &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> contract = drizzle.contracts.MyStringStore;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let drizzle know we want to watch the `myString` method</span></span><br><span class="line">    <span class="keyword">const</span> dataKey = contract.methods[<span class="string">"myString"</span>].cacheCall();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save the `dataKey` to local component state for later reference</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; dataKey &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// get the contract state from drizzleState</span></span><br><span class="line">    <span class="keyword">const</span> &#123; MyStringStore &#125; = <span class="keyword">this</span>.props.drizzleState.contracts;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// using the saved `dataKey`, get the variable we're interested in</span></span><br><span class="line">    <span class="keyword">const</span> myString = MyStringStore.myString[<span class="keyword">this</span>.state.dataKey];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if it exists, then we display its value</span></span><br><span class="line">    <span class="keyword">return</span> &lt;p&gt;My stored string: &#123;myString &amp;&amp; myString.value&#125;&lt;/p&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ReadString;</span><br></pre></td></tr></table></figure>
<p>如果一切正常，您的应用应显示 “Hello World” 。 但首先，让我们来看看我们在这里所做的事情。</p>
<h3 id="9-2-1-组件安装时"><a href="#9-2-1-组件安装时" class="headerlink" title="9.2.1 组件安装时"></a>9.2.1 组件安装时</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; drizzle &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">  <span class="keyword">const</span> contract = drizzle.contracts.MyStringStore;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// let drizzle know we want to watch the `myString` method</span></span><br><span class="line">  <span class="keyword">const</span> dataKey = contract.methods[<span class="string">"myString"</span>].cacheCall();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save the `dataKey` to local component state for later reference</span></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; dataKey &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当组件安装时，我们首先获取对我们感兴趣的合同的引用并将其分配给 <code>contract</code> 。</p>
<p>然后我们需要告诉 Drizzle 跟踪我们感兴趣的变量。为了做到这一点，我们在<code>myString</code> getter 方法上调用 <code>.cacheCall（）</code> 函数。</p>
<p>我们得到的返回是 <code>dataKey</code> ，它允许我们引用这个变量。 我们将其保存到组件的状态，以便稍后使用。</p>
<h3 id="9-2-2-render-方法"><a href="#9-2-2-render-方法" class="headerlink" title="9.2.2 render 方法"></a>9.2.2 <code>render</code> 方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="comment">// get the contract state from drizzleState</span></span><br><span class="line">  <span class="keyword">const</span> &#123; MyStringStore &#125; = <span class="keyword">this</span>.props.drizzleState.contracts;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// using the saved `dataKey`, get the variable we're interested in</span></span><br><span class="line">  <span class="keyword">const</span> myString = MyStringStore.myString[<span class="keyword">this</span>.state.dataKey];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if it exists, then we display its value</span></span><br><span class="line">  <span class="keyword">return</span> &lt;p&gt;My stored string: &#123;myString &amp;&amp; myString.value&#125;&lt;/p&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从 <code>drizzleState</code> 中，我们获取了我们感兴趣的状态片段，在本例中是 <code>MyStringStore</code> 合约。 从那里，我们使用之前保存的 <code>dataKey</code> 来访问<code>myString</code> 变量。</p>
<p>最后，我们编写 <code>myString &amp;&amp; myString.value</code> 来显示变量的值（如果存在），否则不显示。 在这种情况下，它应该显示 “Hello World” ，因为这是合同初始化的字符串。</p>
<h3 id="9-3-快速回顾"><a href="#9-3-快速回顾" class="headerlink" title="9.3 快速回顾"></a>9.3 快速回顾</h3><p>这一部分最重要的是，使用 Drizzle 读取值有两个步骤：</p>
<ol>
<li><p>首先，你需要让 Drizzle 了解你想要注意的变量。 Drizzle 会给你一个 <code>dataKey</code> 作为回报，你需要保存它以供以后参考。</p>
</li>
<li><p>其次，由于Drizzle工作方式的异步性，你应该注意 <code>drizzleState</code> 的变化。 一旦 <code>dataKey</code> 访问的变量存在，您将能够获得您感兴趣的值。</p>
</li>
</ol>
<h2 id="10-写一个写入智能合约的组件"><a href="#10-写一个写入智能合约的组件" class="headerlink" title="10. 写一个写入智能合约的组件"></a>10. 写一个写入智能合约的组件</h2><p>当然，简单地阅读预先初始化的变量根本就没有乐趣; 我们想要一些我们可以互动的东西。 在本节中，我们将创建一个输入框，您可以在其中键入您选择的字符串，并将其永久保存到区块链中！</p>
<p>首先，让我们创建一个新文件 <code>client/src/SetString.js</code> 并粘贴如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetString</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">stackId</span>: <span class="literal">null</span> &#125;;</span><br><span class="line"></span><br><span class="line">  handleKeyDown = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// if the enter key is pressed, set the value with the string</span></span><br><span class="line">    <span class="keyword">if</span> (e.keyCode === <span class="number">13</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setValue(e.target.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  setValue = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; drizzle, drizzleState &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> contract = drizzle.contracts.MyStringStore;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let drizzle know we want to call the `set` method with `value`</span></span><br><span class="line">    <span class="keyword">const</span> stackId = contract.methods[<span class="string">"set"</span>].cacheSend(value, &#123;</span><br><span class="line">      <span class="keyword">from</span>: drizzleState.accounts[<span class="number">0</span>]</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save the `stackId` for later reference</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; stackId &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  getTxStatus = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// get the transaction states from the drizzle state</span></span><br><span class="line">    <span class="keyword">const</span> &#123; transactions, transactionStack &#125; = <span class="keyword">this</span>.props.drizzleState;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get the transaction hash using our saved `stackId`</span></span><br><span class="line">    <span class="keyword">const</span> txHash = transactionStack[<span class="keyword">this</span>.state.stackId];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if transaction hash does not exist, don't display anything</span></span><br><span class="line">    <span class="keyword">if</span> (!txHash) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// otherwise, return the transaction status</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`Transaction status: <span class="subst">$&#123;transactions[txHash].status&#125;</span>`</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> onKeyDown=&#123;<span class="keyword">this</span>.handleKeyDown&#125; /&gt;</span><br><span class="line">        &lt;div&gt;&#123;<span class="keyword">this</span>.getTxStatus()&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> SetString;</span><br></pre></td></tr></table></figure>
<p>此时，导入并将其包含在 <code>App.js</code> 中，就像使用 <code>ReadString</code> 组件一样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SetString <span class="keyword">from</span> <span class="string">"./SetString"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.loading) <span class="keyword">return</span> <span class="string">"Loading Drizzle..."</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">        &lt;ReadString</span><br><span class="line">          drizzle=&#123;<span class="keyword">this</span>.props.drizzle&#125;</span><br><span class="line">          drizzleState=&#123;<span class="keyword">this</span>.state.drizzleState&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;SetString</span><br><span class="line">          drizzle=&#123;<span class="keyword">this</span>.props.drizzle&#125;</span><br><span class="line">          drizzleState=&#123;<span class="keyword">this</span>.state.drizzleState&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br></pre></td></tr></table></figure>
<p>此时，应用程序应该工作，你应该尝试一下。 您应该能够在输入文本框中键入内容，按 Enter 键，Drizzle 的 react store 将自动显示新字符串。</p>
<p>接下来，让我们一步一步地浏览 <code>SetString.js</code> 。</p>
<h3 id="10-1-一般结构"><a href="#10-1-一般结构" class="headerlink" title="10.1 一般结构"></a>10.1 一般结构</h3><p>首先让我们看看我们需要的一般 <code>React.js</code> 样板。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SetString</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">stackId</span>: <span class="literal">null</span> &#125;;</span><br><span class="line"></span><br><span class="line">  handleKeyDown = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// if the enter key is pressed, set the value with the string</span></span><br><span class="line">    <span class="keyword">if</span> (e.keyCode === <span class="number">13</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setValue(e.target.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  setValue = <span class="function"><span class="params">value</span> =&gt;</span> &#123; ... &#125;;</span><br><span class="line"></span><br><span class="line">  getTxStatus = <span class="function"><span class="params">()</span> =&gt;</span> &#123; ... &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> onKeyDown=&#123;<span class="keyword">this</span>.handleKeyDown&#125; /&gt;</span><br><span class="line">        &lt;div&gt;&#123;<span class="keyword">this</span>.getTxStatus()&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个组件中，我们将有一个输入文本框供用户输入一个字符串，当按下 Enter 键时，将调用 <code>setValue</code> 方法，并将字符串作为参数。</p>
<p>此外，我们将显示交易的状态。 <code>getTxStatus</code> 方法将通过引用 <code>stackId</code> 状态变量返回显示事务状态的字符串（稍后将详细介绍）。</p>
<h3 id="10-2-提交交易"><a href="#10-2-提交交易" class="headerlink" title="10.2 提交交易"></a>10.2 提交交易</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setValue = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; drizzle, drizzleState &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">  <span class="keyword">const</span> contract = drizzle.contracts.MyStringStore;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// let drizzle know we want to call the `set` method with `value`</span></span><br><span class="line">  <span class="keyword">const</span> stackId = contract.methods[<span class="string">"set"</span>].cacheSend(value, &#123;</span><br><span class="line">    <span class="keyword">from</span>: drizzleState.accounts[<span class="number">0</span>]</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save the `stackId` for later reference</span></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; stackId &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们首先将 <code>drizzle</code> 实例中的 <code>contract</code> 分配给合约，然后我们在我们感兴趣的方法上调用 <code>cacheSend（）</code>（即 <code>set</code> ）。 然后我们传入我们想要设置的字符串（即 <code>value</code>）以及我们的事务选项（在这种情况下，只是 <code>from</code> 字段）。 请注意，我们可以从 <code>drizzleState.accounts [0]</code> 获取当前帐户地址。</p>
<p>我们得到的是 <code>stackId</code> ，它是我们想要执行的事务的引用。 以太坊交易在广播到网络之前不会收到哈希值。 如果在广播之前发生错误， Drizzle 会通过提供每个自己的 ID 来跟踪这些事务。 成功广播后， <code>stackId</code> 将指向事务哈希，因此我们将其保存在本地组件状态以供以后使用。</p>
<h3 id="10-3-跟踪交易状态"><a href="#10-3-跟踪交易状态" class="headerlink" title="10.3 跟踪交易状态"></a>10.3 跟踪交易状态</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">getTxStatus = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// get the transaction states from the drizzle state</span></span><br><span class="line">  <span class="keyword">const</span> &#123; transactions, transactionStack &#125; = <span class="keyword">this</span>.props.drizzleState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the transaction hash using our saved `stackId`</span></span><br><span class="line">  <span class="keyword">const</span> txHash = transactionStack[<span class="keyword">this</span>.state.stackId];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if transaction hash does not exist, don't display anything</span></span><br><span class="line">  <span class="keyword">if</span> (!txHash) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// otherwise, return the transaction status</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`Transaction status: <span class="subst">$&#123;transactions[txHash].status&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>现在我们已将 <code>stackId</code> 保存到本地组件状态，我们可以使用它来检查事务的状态。 首先，我们需要来自 <code>drizzleState</code> 的 <code>transaction</code> 和<code>transactionStack</code> 切片状态。</p>
<p>然后，我们可以通过 <code>transactionStack [stackId]</code> 获取事务哈希（分配给 <code>txHash</code> ）。 如果哈希不存在，那么我们知道事务尚未广播，我们返回 null 。</p>
<p>否则，我们会显示一个字符串以显示我们的交易状态。 通常，这将是“待定”或“成功”。</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>恭喜！ 您已经迈出了一大步，了解 Drizzle 的工作原理。 当然，这只是一个开始，您可以使用像 <a href="https://github.com/trufflesuite/drizzle-react">drizzle-react</a> 这样的工具来帮助您将 Drizzle 集成到您的 dapp 中，从而减少您必须编写的必要样板。</p>
<p>或者，您也可以使用我们的 <a href="https://github.com/truffle-box/drizzle-box">Truffle box</a> 来引导您的 Drizzle dapp 。</p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/sulenn/sulenn.github.io" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://weibo.com/u/5649728079" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="mailto:273409891@qq.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                </ul>
                
                <p class="copyright text-muted">&copy; 2019 qiubing &nbsp;&nbsp;  <span id="busuanzi_container_site_pv">总访问量 <span id="busuanzi_value_site_pv"></span></span> &nbsp;&nbsp; 总字数  <span class="post-count">26.6k</span><br></p>
                <!-- <p class="copyright text-muted">
                    <span id="busuanzi_container_site_pv">访问量<span id="busuanzi_value_site_pv"></span></span>
                </p> -->
                <p class="copyright text-muted">框架 <a target="_blank" href="https://hexo.io/zh-cn/">Hexo</a> &nbsp;&nbsp; 主题 <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog</a></p>
                <!-- <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p> -->
                <!-- <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p> -->
            </div>
        </div>
    </div>
</footer>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>